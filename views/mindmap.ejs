<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Mindmap</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/src/mindmap.css">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <script src="/dist/mindmap.min.js"></script>
</head>

<body id="body"> 
    <div class="col text-left">
        <button onclick=save() class="btn btn-primary">Save</button>
        <button onclick=openFile() class="btn btn-primary">Open</button>
    </div>
    <form id="form" method="POST" style="display: none;" class="form-inline">
        <div class="form-group mx-sm-3 mb-2">
            <input type="text" class="form-control" required placeholder="Name for saving the file" name="map_name">
            <input style="display: none;" type="text" class="form-control" id="code" name="html">
            <input type="submit" class="btn btn-danger" value="Save">
        </div>
    </form>

    <form id="form2" method="GET" style="display: none;" class="form-inline">
        <div class="form-group mx-sm-3 mb-2">
            <% mindmaps.forEach(function(mindmap){ %>
                <a href="mindmap/<%=mindmap._id%>"> <%=mindmap.map_name%>
                </a>
                <% }); %> 
            <input type="submit" class="btn btn-danger" value="Open">
        </div>
    </form>
    <div class="mindmap">
        <ol class="children children_leftbranch" id="left"></ol>
        <button onclick=addLeftNode()><i class="fa fa-plus"></i></button>
        <div id="parent" class="node node_root">
            <div contenteditable="true">Central Idea</div>
        </div>
        <button onclick=addRightNode()><i class="fa fa-plus"></i></button>
        <ol class="children children_rightbranch" id="right"></ol>
    </div>
    <script>
        function addRightNode() {
            document.getElementById("right").innerHTML += '<li id=' + unique +
                'd class="children__item"><div class="node"><div  class="node__text">New Idea</div><input type="text" class="node__input"></div><button onclick=addRight(this)><i class="fa fa-plus"></i></button><ol id=' +
                unique + ' class="children"></ol></li>';
            unique++;
        }

        function addRight(elem) {
            var id = $(elem).parent().attr("id");
            id = id.slice(0, -1);
            document.getElementById(id).innerHTML += '<li id=' + unique +
                'd class="children__item"><div  class="node"><div class="node__text">New Idea</div><input type="text" class="node__input"></div><button onclick=addRight(this)><i class="fa fa-plus"></i></button><ol id=' +
                unique + ' class="children"></ol></li>';
            unique++;
        }

        let unique2 = 100;

        function addLeftNode() {
            document.getElementById("left").innerHTML += '<li id=' + unique2 +
                'd class="children__item"><div  class="node"><div class="node__text">New Idea</div><input type="text" class="node__input"></div><button onclick=addLeft(this)><i class="fa fa-plus"></i></button><ol id=' +
                unique2 + ' class="children"></ol></li>';
            unique2++;
        }

        function addLeft(elem) {
            var id = $(elem).parent().attr("id");
            id = id.slice(0, -1);
            document.getElementById(id).innerHTML += '<li id=' + unique2 +
                'd class="children__item"><div  class="node"><div  class="node__text">New Idea</div><input type="text" class="node__input"></div><button onclick=addLeft(this)><i class="fa fa-plus"></i></button><ol id=' +
                unique2 + ' class="children"></ol></li>';
            unique2++;
        }

        function deleteNode() {
            alert("delete");
        }

        function save() {
            document.getElementById("form2").style = "display:none";
            document.getElementById("form").style = "display:block";
            let myHtml = document.getElementsByClassName("mindmap")[0].innerHTML;
            myHtml = myHtml + "<style>body{margin:0;padding:0;height:100%;background:#efefef;color:#222;font:13px/22px 'Helvetica Neue',Helvetica,Arial,sans-serif;-webkit-font-smoothing:antialiased}.mindmap{-webkit-user-select:none;-moz-user-select:none;user-select:none;width:100%;height:100%;text-align:center;white-space:nowrap}.mindmap:before{content:'';display:inline-block;vertical-align:middle;height:100%;width:0}.node{position:relative;display:inline-block;vertical-align:middle;height:22px;border:1px solid #243e7c;padding:25px;margin:15px 0;background:#fff;border-radius:6px;text-align:left;cursor:pointer;transition:all .2s;direction:ltr}.node:hover{box-shadow:0 0 3px 0 #3498db}.node:active{box-shadow:0 0 1px 0 #3498db}.node__input{border:0;margin:0;padding:0;position:absolute;padding:0 3px 0 4px;top:0;right:0;left:20px;height:50px;font:inherit;display:none;background:0 0;color:inherit}.node__input:focus{outline:0}.node_active,.node_active:hover{box-shadow:0 0 2px 1px #3498db}.node_root{border:0;background:#3498db;color:#fff;font:18px/32px 'Helvetica Neue',Helvetica,Arial,sans-serif;padding:0 20px;height:32px}.node_root .node__input{height:32px;padding:0 9px 0 10px}.node__text{font-size:15px;margin-top:-11px;margin-left:auto;margin-right:auto}.node_editable{border:1px solid #3498db}.node_editable.node_root{border:0}.node_editable .node__text{height:0;overflow:hidden}.node_editable .node__input{display:block}.children{position:relative;list-style:none;margin:0;text-align:left;padding:0 0 0 6px;display:inline-block;vertical-align:middle}.children:before{content:'';position:absolute;top:50%;left:-4px;width:10px;border-top:1px solid #243e7c}.children__item{position:relative;padding:0 0 0 10px;border-left:1px solid #243e7c}.children__item:first-child,.children__item:last-child{border-left:1px solid transparent}.children__item:before{content:'';width:10px;border-top:1px solid #243e7c;position:absolute;top:50%;left:0}.children__item:first-child:before{left:-1px;bottom:0;border-radius:4px 0 0 0;border-left:1px solid #243e7c}.children__item:last-child:before{left:-1px;top:0;bottom:50%;border-radius:0 0 0 4px;border:0;border-left:1px solid #243e7c;border-bottom:1px solid #243e7c}.children__item:first-child:last-child:before{top:50%;bottom:auto;border:0;border-radius:0;border-top:1px solid #243e7c}.children_leftbranch,.children_leftbranch .children{direction:rtl;text-align:right;padding:0 6px 0 0}.children_leftbranch .children:before,.children_leftbranch:before{left:auto;right:-4px}.children_leftbranch .children__item{padding:0 10px 0 0;border:0;border-right:1px solid #243e7c}.children_leftbranch .children__item:first-child,.children_leftbranch .children__item:last-child{border-right:1px solid transparent}.children_leftbranch .children__item:before{top:50%;left:auto;right:0}.children_leftbranch .children__item:first-child:before{right:-1px;border:0;border-radius:0 4px 0 0;border-top:1px solid #243e7c;border-right:1px solid #243e7c}.children_leftbranch .children__item:last-child:before{right:-1px;top:0;bottom:50%;border-radius:0 0 4px 0;border:0;border-right:1px solid #243e7c;border-bottom:1px solid #243e7c}.children_leftbranch .children__item:first-child:last-child:before{top:50%;bottom:auto;border:0;border-radius:0;border-top:1px solid #243e7c}button{font-size:15px;border-radius:10px;background-color:#3498ab;border:none;color:#fff;margin-left:2px;margin-right:2px}</style>"
            document.getElementById('code').value = myHtml;
        }

        function openFile() {
            document.getElementById("form").style = "display:none";
            document.getElementById("form2").style = "display:block";
        }

        function toHTML(myLink) {
            var newString;
            newString = myLink.split("+").join(" ");
            newString = newString.split("%2F").join("/");
            newString = newString.split("%3D").join("=");
            newString = newString.split("%28").join("(");
            newString = newString.split("%29").join(")");
            return newString;
        }
    </script>
</body>

</html>